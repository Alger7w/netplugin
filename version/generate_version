#!/bin/bash

# generates the version of file based on current git version

cd $GOPATH/src/github.com/contiv/netplugin/version

USE_RELEASE=$1

if [ -z "${USE_RELEASE}" ]
then
  file_name=version_default.go
  UseVersionStr="// +build !use_version" 
  useDefaultVersionString="False"
else
  file_name=version_release.go
  UseVersionStr="// +build use_version" 
  useDefaultVersionString="True"
fi

GitCommitStr=`git show | grep commit | cut -f 2 -d ' ' | cut -b 1-10`
VersionStr=`cat CURRENT_VERSION`
BuildTimeStr=`date`

cat > $file_name << EOF
$UseVersionStr
// NOTE: this file is auto-generated by PR commits

package version

const usedDefaultVersion = "$useDefaultVersionString"

// sample values are specified here
const (
	gitCommit  string = "$GitCommitStr"
	versionStr string = "$VersionStr"
	buildTime  string = "$BuildTimeStr"
)
EOF

exit 0
